---
title: Title
bibliography: ./other/burd_recruiting_chapter.bib
format:
  revealjs: 
    theme: [default, ./assets/css/custom.scss]
    controls: true
    controls-layout: bottom-right
    controls-tutorial: true
    transition: slide
    background-transition: fade
    auto-stretch: false
include-in-header: ./assets/html/header.html
# https://github.com/quarto-dev/quarto-cli/discussions/5853#discussioncomment-6126603
# filters:
#   - /path/to/relevel_headings.lua
---

```{r setup, include = FALSE}
library(tidyverse)
library(kableExtra)  # For collapse_rows() to work: https://stackoverflow.com/a/67803915/6373540
library(readxl)

knitr::opts_chunk$set(echo = F, message = F)

data_dir <- file.path('.', 'data')
tables_dir <- file.path('.', 'assets', 'tables')
figures_dir <- file.path('.', 'assets', 'figures')

univ_sample_df <- readRDS(file.path(data_dir, 'univ_sample.RDS')) %>%
  arrange(desc(classification), rank)
events_df <- readRDS(file.path(data_dir, 'events_data.RDS'))

pubhs_universe_df <- readRDS(file.path(data_dir, 'pubhs_universe.RDS'))
privhs_universe_df <- readRDS(file.path(data_dir, 'privhs_universe.RDS'))

ego_df <- readRDS(file.path(tables_dir, 'table_ego_all.RDS')) %>% 
  mutate(
    univ_region = str_split(characteristics, '\\|', simplify = T)[,1],
    univ_religion = str_split(characteristics, '\\|', simplify = T)[,2],
    univ_race = round(as.numeric(str_split(characteristics, '\\|', simplify = T)[,3]), 1),
    univ_rank = as.numeric(str_split(characteristics, '\\|', simplify = T)[,4]),
    univ_enroll = format(as.numeric(str_split(characteristics, '\\|', simplify = T)[,5]), big.mark = ',')
  )
```

## Characteristics of universities in analysis sample

<div class="table-wrapper" id="tbl-1">
```{r sample-characteristics}
univ_sample <- univ_sample_df %>% 
  filter(classification != 'private_libarts') %>% 
  select(classification, univ_abbrev, rank, satactcomp25, satactcomp75, tfuginst, tfugoutst, ugftptfreshtot, freshoutstpct, pgrnt_p, pctfreshwh, pctfreshbl, pctfreshap, pctfreshhi, pctfreshal) %>% 
  mutate(
    classification = recode(
      classification,
      'public_research' = 'Public Research',
      'private_national' = 'Private National'
    ),
    satactcomp25 = format(round(satactcomp25), big.mark = ',', trim = T),
    satactcomp75 = format(round(satactcomp75), big.mark = ',', trim = T),
    tfuginst = str_c('$', format(round(tfuginst), big.mark = ',', trim = T)),
    tfugoutst = str_c('$', format(round(tfugoutst), big.mark = ',', trim = T)),
    ugftptfreshtot = format(round(ugftptfreshtot), big.mark = ',', trim = T),
    freshoutstpct = str_c(format(round(freshoutstpct * 100, 1), nsmall = 1), '%'),
    pgrnt_p = str_c(format(round(pgrnt_p, 1), nsmall = 1), '%'),
    pctfreshwh = str_c(format(round(pctfreshwh, 1), nsmall = 1), '%'),
    pctfreshbl = str_c(format(round(pctfreshbl, 1), nsmall = 1), '%'),
    pctfreshap = str_c(format(round(pctfreshap, 1), nsmall = 1), '%'),
    pctfreshhi = str_c(format(round(pctfreshhi, 1), nsmall = 1), '%'),
    pctfreshal = str_c(format(round(pctfreshal, 1), nsmall = 1), '%')
  ) %>% 
  arrange(desc(classification), rank)

names(univ_sample) <- c('Classification', 'University', 'Rank', '25th Percentile SAT/ACT Composite Score', '75th Percentile SAT/ACT Composite Score', 'In-State Tuition + Fees', 'Out-of-State Tuition + Fees', 'Total Enrolled Freshmen', 'Percent<br>Out-of-State Freshmen', 'Percent Pell Recipients', 'Percent White Freshmen', 'Percent Black Freshmen', 'Percent Asian Freshmen', 'Percent Hispanic Freshmen', 'Percent International Freshmen')

kbl(univ_sample, align = c('l', 'l', rep('r', 13)), escape = F) %>% 
  collapse_rows(columns = 1, valign = 'middle') %>% 
  column_spec(4, width_min = '1.2in') %>% 
  column_spec(6, width_min = '0.9in') %>% 
  column_spec(8, width_min = '0.9in')
```
</div>

## Characteristics of universities in analysis sample compared to data collection sample

<div class="table-wrapper">
```{r sample-population-characteristics}
cc2000_edition_data <- read_excel(file.path(data_dir, 'cc2000_edition_data.xls'), sheet = 'Data')
pop_pubu <- (cc2000_edition_data %>% filter(`Control (text)` == 'Public', `CC2000 (text)` == 'Doctoral/Research Universitiesâ€”Extensive'))$UNITID %>% as.character()

usnews_rankings <- read_csv(file.path(data_dir, 'usnews_rankings.csv'), col_select = c('source', 'control', 'rank', 'univ_id'))
pop_privu <- (usnews_rankings %>% filter(source == 'national-universities', control == 'private', rank <= 100))$univ_id %>% as.character()

sample_pubu <- (univ_sample_df %>% filter(classification == 'public_research'))$univ_id
sample_privu <- (univ_sample_df %>% filter(classification == 'private_national'))$univ_id

univ_pop <- read.csv(file.path(data_dir, 'ipeds_data.csv'), header = TRUE, na.strings = c('', 'NULL', 'NA'), stringsAsFactors = FALSE, colClasses = c('unitid' = 'character')) %>% as_tibble() %>%
  filter(endyear == 2017, unitid %in% c(pop_pubu, pop_privu, sample_pubu, sample_privu)) %>% 
  select(unitid, satactcomp25, satactcomp75, tfuginst, tfugoutst, ugftptfreshtot, freshoutstpct, pgrnt_n, cohortsfaef, ugftptfreshwhmf, ugftptfreshblmf, ugftptfreshapmf, ugftptfreshhimf, ugftptfreshalmf, ugftptfreshmrmf, ugftptfreshnamf, ugftptfreshunmf, ugftptfreshasmf, ugftptfreshnhmf) %>% 
  mutate(
    pgrnt_p = pgrnt_n / cohortsfaef * 100,
    pctfreshwh = ugftptfreshwhmf / ugftptfreshtot * 100,
    pctfreshbl = ugftptfreshblmf / ugftptfreshtot * 100,
    pctfreshap = ugftptfreshapmf / ugftptfreshtot * 100,  # ap = as + nh
    pctfreshhi = ugftptfreshhimf / ugftptfreshtot * 100,
    pctfreshal = ugftptfreshalmf / ugftptfreshtot * 100,
    pctfreshmr = ugftptfreshmrmf / ugftptfreshtot * 100,
    pctfreshna = ugftptfreshnamf / ugftptfreshtot * 100,
    pctfreshun = ugftptfreshunmf / ugftptfreshtot * 100,
    pctfreshas = ugftptfreshasmf / ugftptfreshtot * 100,
    pctfreshnh = ugftptfreshnhmf / ugftptfreshtot * 100
  ) %>% 
  select(unitid, satactcomp25, satactcomp75, tfuginst, tfugoutst, ugftptfreshtot, freshoutstpct, pgrnt_p, pctfreshwh, pctfreshbl, pctfreshap, pctfreshhi, pctfreshal)

format_data <- function(univ_ids) {
  apply(univ_pop %>% filter(unitid %in% univ_ids) %>% select(-unitid), 2, function(x) quantile(x, probs = c(0.25, 0.5, 0.75), na.rm = T)) %>% 
    as.data.frame() %>% 
    mutate(
      satactcomp25 = format(round(satactcomp25), big.mark = ',', trim = T),
      satactcomp75 = format(round(satactcomp75), big.mark = ',', trim = T),
      tfuginst = str_c('$', format(round(tfuginst), big.mark = ',', trim = T)),
      tfugoutst = str_c('$', format(round(tfugoutst), big.mark = ',', trim = T)),
      ugftptfreshtot = format(round(ugftptfreshtot), big.mark = ',', trim = T),
      freshoutstpct = str_c(format(round(freshoutstpct * 100, 1), nsmall = 1), '%'),
      pgrnt_p = str_c(format(round(pgrnt_p, 1), nsmall = 1), '%'),
      pctfreshwh = str_c(format(round(pctfreshwh, 1), nsmall = 1), '%'),
      pctfreshbl = str_c(format(round(pctfreshbl, 1), nsmall = 1), '%'),
      pctfreshap = str_c(format(round(pctfreshap, 1), nsmall = 1), '%'),
      pctfreshhi = str_c(format(round(pctfreshhi, 1), nsmall = 1), '%'),
      pctfreshal = str_c(format(round(pctfreshal, 1), nsmall = 1), '%')
    ) %>% 
    t()
}

univ_pop_df <- cbind(
  format_data(sample_pubu),
  format_data(pop_pubu),
  format_data(sample_privu),
  format_data(pop_privu)
)
rownames(univ_pop_df) <- c('25th Percentile SAT/ACT Composite Score', '75th Percentile SAT/ACT Composite Score', 'In-State Tuition + Fees', 'Out-of-State Tuition + Fees', 'Total Enrolled Freshmen', 'Percent Out-of-State Freshmen', 'Percent Pell Recipients', 'Percent White Freshmen', 'Percent Black Freshmen', 'Percent Asian Freshmen', 'Percent Hispanic Freshmen', 'Percent International Freshmen')
colnames(univ_pop_df) <- rep(c('25th percentile', '50th percentile', '75th percentile'), 4)

kbl(univ_pop_df, align = 'r', escape = F) %>%
  add_header_above(header = c(' ' = 1, 'Analysis sample (N=15)' = 3, 'Data collection sample (N=102)' = 3, 'Analysis sample (N=14)' = 3, 'Data collection sample (N=57)' = 3)) %>%
  add_header_above(header = c(' ' = 1, 'Public research universities' = 6, 'Selective private universities' = 6)) %>% 
  column_spec(1, bold = T) %>%
  column_spec(2:13, width_min = '0.9in')
```
</div>

## One-mode public university percent matrix

<div class="table-wrapper tbl-1mode">
```{r pubu-percent-matrix}
table_1mode_pubu <- readRDS(file = file.path(tables_dir, 'table_1mode_pubu.RDS'))
rownames(table_1mode_pubu$onemode_pct_df) <- colnames(table_1mode_pubu$onemode_pct_df)

names(table_1mode_pubu$onemode_pct_df) <- str_replace(names(table_1mode_pubu$onemode_pct_df), ' \\(', '<br>(')

kable(table_1mode_pubu$onemode_pct_df, align = 'r', escape = F) %>%
  column_spec(1, bold = T) %>% 
  column_spec(2:16, width_min = '0.9in')
```
</div>

## One-mode private university percent matrix

<div class="table-wrapper tbl-1mode">
```{r privu-percent-matrix}
table_1mode_privu <- readRDS(file = file.path(tables_dir, 'table_1mode_privu.RDS'))
rownames(table_1mode_privu$onemode_pct_df) <- colnames(table_1mode_privu$onemode_pct_df)

names(table_1mode_privu$onemode_pct_df) <- str_replace(names(table_1mode_privu$onemode_pct_df), ' \\(', '<br>(')

kable(table_1mode_privu$onemode_pct_df, align = 'r', escape = F) %>%
  column_spec(1, bold = T) %>% 
  column_spec(2:15, width_min = '0.9in')
```
</div>

## For private universities, the percent of high schools visited by public universities

<div class="table-wrapper tbl-1mode">
```{r privu-percent-visited-by-pubu-matrix}
table_1mode_u <- readRDS(file = file.path(tables_dir, 'table_1mode_u.RDS'))
rownames(table_1mode_u$onemode_pct_df) <- colnames(table_1mode_u$onemode_pct_df)

names(table_1mode_u$onemode_pct_df) <- str_replace(names(table_1mode_u$onemode_pct_df), ' \\(', '<br>(')

kable(table_1mode_u$onemode_pct_df[c(1,7,9,13,16,17,18,21,22,23,24,25,27,28,29),c(2,3,4,5,6,8,10,11,12,14,15,19,20,26)], align = 'r', escape = F) %>%
  column_spec(1, bold = T) %>% 
  column_spec(2:15, width_min = '0.9in')
```
</div>

## For public universities, the percent of high schools visited by private universities

<div class="table-wrapper tbl-1mode">
```{r pubu-percent-visited-by-privu-matrix}
kable(table_1mode_u$onemode_pct_df[c(2,3,4,5,6,8,10,11,12,14,15,19,20,26),c(1,7,9,13,16,17,18,21,22,23,24,25,27,28,29)], align = 'r', escape = F) %>%
  column_spec(1, bold = T) %>% 
  column_spec(2:16, width_min = '0.9in')
```
</div>

## Order 2 ego network of University of Notre Dame

![](./assets/figures/nd_religion.png)

## Number of HS visits by public research universities

![](./assets/figures/events_hs_count_pubu.png)

## Number of HS visits by selective private universities

![](./assets/figures/events_hs_count_privu.png)

## Proportional HS visits by public research universities

![](./assets/figures/events_hs_actual_proportional_pubu.png)

## Proportional HS visits by selective private universities

![](./assets/figures/events_hs_actual_proportional_privu.png)

## One-mode network for all universities

![](./assets/figures/plot_1mode_u.png)

## Geographic region of visited private high schools

![](./assets/figures/ego_network_region_pubu_privu.png)

## Religious affiliation of visited private high schools

![](./assets/figures/ego_network_religion_pubu_privu.png)

## High school ranking of visited private high schools

![](./assets/figures/ego_network_rank_pubu_privu.png)

## Racial composition of visited HS, public universities

![](./assets/figures/ego_network_race_pubu_privhs_pubhs.png)

## Racial composition of visited HS, private universities

![](./assets/figures/ego_network_race_privu_privhs_pubhs.png)

## Racial composition in the South, public universities

![](./assets/figures/south_race_pubu_privhs_pubhs.png)

## Racial composition in the South, private universities

![](./assets/figures/south_race_privu_privhs_pubhs.png)

## Slide w/ citation
### Subtitle

<hr>

Here's some text:

- @RN4504 said blah...
- Parenthetical citation [@RN4625].
- **Bold** and _italic_ text

More things:

- Blah

## References
